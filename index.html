<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Final Stand Remastered â€” Calculators & Battle Sim created by CrYm0</title>
<style>
  :root{
  --bg:#0b0d10; --card:#12161c; --muted:#9aa4b2; --text:#e6edf3; --accent:#ffc24a; --line:#222a33;
  --wrap-max:1200px;       /* cap content width for consistency */
  --wrap-pad:24px;         /* side padding */
}

/* Typography: scale lightly with screen size, but stay close to 1080p look */
html{
  font-size: clamp(13.5px, 0.95vw + 8px, 16px);
}
body{ margin:0; background:var(--bg); color:var(--text); font:14px/1.45 system-ui,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial }

/* ---------- Layout shell ---------- */
.wrap{
  width:100%;
  max-width:var(--wrap-max);
  margin:0 auto;
  padding:0 var(--wrap-pad);
  box-sizing:border-box;
}

header{ display:flex; align-items:center; gap:12px; margin:24px 0 18px }
h1{ font-size:1.35rem; margin:0 }
h2{ margin:0 0 8px; font-size:1.1rem }
h3{ margin:0 0 6px; font-size:1rem }

.card{
  background:var(--card);
  border:1px solid var(--line);
  border-radius:14px;
  padding:18px;
  box-shadow:0 0 0 1px rgba(0,0,0,.04),0 8px 24px rgba(0,0,0,.25);
  margin-bottom:16px;
}

/* ---------- Grids that adapt nicely ---------- */
.two-col{
  display:grid;
  grid-template-columns: repeat(2, minmax(320px, 1fr));
  gap:16px;
}
@media (max-width: 900px){
  .two-col{ grid-template-columns: 1fr; }
}

/* Generic 12-col form grid */
.grid{
  display:grid;
  grid-template-columns: repeat(12, 1fr);
  gap:12px;
}
.col-6{ grid-column: span 6 }
.col-12{ grid-column: span 12 }
@media (max-width: 560px){
  .col-6{ grid-column: span 12 }
}

/* Stats cards auto-wrap cleanly on all widths */
.stats{
  display:grid;
  grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
  gap:12px;
  margin-top:12px;
}

/* ---------- Controls ---------- */
label{ display:block; font-weight:600; margin:8px 0 6px }
input,select{
  width:100%; background:#0f1318; border:1px solid var(--line); color:var(--text);
  border-radius:10px; padding:10px 12px; outline:none;
}
input:focus,select:focus{ border-color:#2b86ff }
.btn{ cursor:pointer; background:#1a2330; color:var(--text); border:1px solid var(--line); border-radius:10px; padding:10px 14px }
.btn:hover{ border-color:#2b86ff }

.stat{ background:#0f1318; border:1px solid var(--line); border-radius:12px; padding:14px }
.label{ font-size:.9rem; color:var(--muted); margin-bottom:4px }
.value{ font-size:1.35rem; font-weight:800 }
.accent{ color:var(--accent) }
.mini{ font-size:.85rem; color:var(--muted) }
.sidenote{ margin-top:10px; color:var(--muted); font-size:.85rem }
.row{ display:flex; gap:10px; align-items:center; flex-wrap:wrap }
.pill{ display:inline-block; padding:6px 10px; border-radius:999px; border:1px solid var(--line); background:#0f1318 }

/* ---------- Gentle scaling on very large monitors ---------- */
@media (min-width: 1600px){
  html{ font-size: 15.5px; }
}
@media (min-width: 2000px){
  html{ font-size: 16px; }
}
/* === Compact stat input fields === */
input[type="number"],
input[type="text"],
select {
  font-size: 14px;
  padding: 6px 8px;
  height: 34px;
  border-radius: 8px;
  background: #0f1318;
  border: 1px solid var(--line);
  color: var(--text);
  box-sizing: border-box;
}

input[type="number"]:focus,
input[type="text"]:focus,
select:focus {
  border-color: var(--accent);
  outline: none;
}

/* === Ultrawide / large desktop tuning === */
.wrap{
  max-width: clamp(1200px, 80vw, 1600px);
}

.two-col{
  grid-template-columns: repeat(2, minmax(380px, 1fr));
  gap: 18px;
}

.stats{
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
}

input[type="number"],
input[type="text"],
select{
  font-size: 14px;
  padding: 6px 8px;
  height: 34px;
  border-radius: 8px;
}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <svg width="26" height="26" viewBox="0 0 24 24" fill="none"><path d="M4 17h8M4 13h12M4 9h16" stroke="#ffc24a" stroke-width="2" stroke-linecap="round"/></svg>
      <h1>Final Stand Remastered â€” Calculators & Battle Sim created by CrYm0</h1>
    </header>

    <!-- SIDE INFO -->
    <div class="card" id="side-info">
      <h2 style="margin-bottom:6px;">ðŸ“˜ Info</h2>
      <ul id="info-list" style="margin:0; padding-left:18px; color:#b0bac5; font-size:13px; line-height:1.5;">
        <li>STATS OVER 500 DO NOT WORK AS OF RIGHT NOW WORKING ON IT</li>
        <li>Acrosian's Ki blast buff isnâ€™t included.</li>
        <li>SSJ2 (not mastered) â‰ˆ +15% M1 damage from basic scaling.</li>
        <li>SSJ3 (not mastered) â‰ˆ +27% M1 damage from basic scaling.</li>
        <li>You can use capsules in the Battle Simulator â€” remove any that add % or no stats.</li>
        <li>HP Max scaling: +0.5 HP per stat point (no cap).</li>
        <li>Extra M1's from speed dont do more DMG than the basic 4 M1's.</li>
        <li>For any questions/suggestions, DM CrYm0.</li>
      </ul>
    </div>

    <!-- CALCULATORS -->
    <div class="two-col">
      <!-- MELEE -->
      <div class="card">
        <h2>Melee Damage (4Ã—M1) â€” Actual HP DMG</h2>
        <div class="grid">
          <div class="col-6">
            <label>Melee</label>
            <input id="melee" type="number" min="0" step="1" value="100">
          </div>
        </div>
        <div class="row" style="margin-top:12px">
          <button class="btn" id="calcMelee">Calculate</button>
        </div>
        <div class="stats">
          <div class="stat">
            <div class="label">Full M1 combo damage (current)</div>
            <div class="value accent" id="m_total">â€“</div>
          </div>
          <div class="stat">
            <div class="label">Full combo at +10 Melee</div>
            <div class="value" id="m_plus10">â€“</div>
          </div>
          <div class="stat">
            <div class="label">Full combo at +50 Melee</div>
            <div class="value" id="m_plus50">â€“</div>
          </div>
          <div class="stat">
            <div class="label">Full combo at +100 Melee</div>
            <div class="value" id="m_plus100">â€“</div>
          </div>
        </div>
        <div class="sidenote">
          * Based on tested melee scaling vs a 100 HP dummy. Level does not affect melee damage.
        </div>
      </div>

      <!-- KI -->
      <div class="card">
        <h2>Ki Damage (Basic Blasts) â€” Actual HP DMG</h2>
        <div class="grid">
          <div class="col-6">
            <label>Ki</label>
            <input id="ki" type="number" min="0" step="1" value="150">
          </div>
          <div class="col-6">
            <label>Level</label>
            <input id="levelK" type="number" min="0" step="1" value="100">
          </div>
        </div>
        <div class="row" style="margin-top:12px">
          <button class="btn" id="calcKi">Calculate</button>
        </div>
        <div class="stats">
          <div class="stat"><div class="label">Full basic-blast damage</div><div class="value accent" id="k_total">â€“</div></div>
          <div class="stat"><div class="label">Single blast damage</div><div class="value" id="k_hit">â€“</div></div>
          <div class="stat"><div class="label">Damage gain from Level</div><div class="value" id="k_lvl">â€“</div></div>
          <div class="stat"><div class="label">Damage gain from Ki stat</div><div class="value" id="k_ki">â€“</div></div>
        </div>
        <div class="sidenote">* Ki converted from % to HP using a 100 HP baseline.</div>
      </div>
    </div>

    <!-- MELEE RESISTANCE TAB -->
    <div class="card">
      <h2>Melee Resistance â€” Damage Taken (4Ã—M1)</h2>
      <div class="grid">
        <div class="col-6">
          <label>Attacker Melee</label>
          <input id="r_attMelee" type="number" min="0" step="1" value="100">
        </div>
        <div class="col-6">
          <label>Your Melee Resistance</label>
          <input id="r_res" type="number" min="0" step="1" value="0">
        </div>
        <div class="col-6">
          <label>Your HP Max stat</label>
          <input id="r_hp" type="number" min="0" step="1" value="0">
        </div>
      </div>
      <div class="row" style="margin-top:12px">
        <button class="btn" id="calcRes">Calculate</button>
      </div>
      <div class="stats">
        <div class="stat">
          <div class="label">Damage taken now (4Ã—M1)</div>
          <div class="value accent" id="r_now">â€“</div>
        </div>
        <div class="stat">
          <div class="label">Damage taken at +10 Res</div>
          <div class="value" id="r_10">â€“</div>
        </div>
        <div class="stat">
          <div class="label">Damage taken at +50 Res</div>
          <div class="value" id="r_50">â€“</div>
        </div>
        <div class="stat">
          <div class="label">Damage taken at +100 Res</div>
          <div class="value" id="r_100">â€“</div>
        </div>
      </div>
      <div class="sidenote">
        * Values show HP taken and % of your total HP (100 + 0.5Ã—HP Max stat).
      </div>
    </div>

    <!-- BATTLE SIMULATOR -->
    <div class="card">
      <h2>Battle Simulator (A vs B)</h2>
      <div class="mini">Enter both characters. Output shows predicted % HP lost from a full 4Ã—M1 (Melee) and a basic-blast combo (Ki).</div>

      <div class="two-col" style="margin-top:12px">
        <!-- Character A -->
        <div>
          <h3 style="margin:0 0 8px">Character A (attacker in Aâ†’B)</h3>
          <div class="grid">
            <div class="col-6"><label>Level</label><input id="A_lvl" type="number" value="100"></div>
            <div class="col-6"><label>Health Max</label><input id="A_hp" type="number" value="0"></div>
            <div class="col-6"><label>Melee</label><input id="A_melee" type="number" value="100"></div>
            <div class="col-6"><label>Ki</label><input id="A_ki" type="number" value="150"></div>
            <div class="col-6"><label>Melee Res</label><input id="A_resM" type="number" value="0"></div>
            <div class="col-6"><label>Ki Res</label><input id="A_resK" type="number" value="0"></div>
          </div>
        </div>

        <!-- Character B -->
        <div>
          <h3 style="margin:0 0 8px">Character B (attacker in Bâ†’A)</h3>
          <div class="grid">
            <div class="col-6"><label>Level</label><input id="B_lvl" type="number" value="100"></div>
            <div class="col-6"><label>Health Max</label><input id="B_hp" type="number" value="0"></div>
            <div class="col-6"><label>Melee</label><input id="B_melee" type="number" value="100"></div>
            <div class="col-6"><label>Ki</label><input id="B_ki" type="number" value="150"></div>
            <div class="col-6"><label>Melee Res</label><input id="B_resM" type="number" value="0"></div>
            <div class="col-6"><label>Ki Res</label><input id="B_resK" type="number" value="0"></div>
          </div>
        </div>
      </div>

      <div class="row" style="margin-top:12px">
        <button class="btn" id="simRun">Simulate A â†” B</button>
      </div>

      <div class="two-col" style="margin-top:12px">
        <div class="stats">
          <div class="stat">
            <div class="label">A â†’ B (Melee, 4Ã—M1)</div>
            <div class="value accent" id="AB_melee">â€“</div>
          </div>
          <div class="stat">
            <div class="label">A â†’ B (Ki, blasts)</div>
            <div class="value" id="AB_ki">â€“</div>
          </div>
        </div>
        <div class="stats">
          <div class="stat">
            <div class="label">B â†’ A (Melee, 4Ã—M1)</div>
            <div class="value accent" id="BA_melee">â€“</div>
          </div>
          <div class="stat">
            <div class="label">B â†’ A (Ki, blasts)</div>
            <div class="value" id="BA_ki">â€“</div>
          </div>
        </div>
      </div>

      <div class="sidenote">* Max HP = 100 + 0.5Ã—HealthMax. Resistances use tested curves; numbers are not final / scaling is not 100% correct.</div>
    </div>

    <div class="muted" style="margin-top:12px">No tracking. All math runs locally in your browser.</div>
  </div>

<script>
  // =================== CONSTANTS / MODELS ===================
  const BASE_HP_H1 = 100;          // baseline HP for Ki %â†’HP
  const SCALE = 0.95;              // Ki tuning

  // --- Ki model (unchanged from your previous setup) ---
  const K_BASE = 19.9;
  const K_COEF = 0.0101;
  const K_EXP  = 1.46;
  const K_LVL  = 0.0111;

  const CAL = {
    KI_LEVEL_FACTOR: 0.50,
    KI_PCT_SCALE:   0.985
  };

  function pctToHP(p){ return (p/100) * BASE_HP_H1; }

  // =================== NEW MELEE MODEL (piecewise, RAW HP, NO level) ===================
  // Returns HP damage of a full 4x M1 combo vs a 100 HP dummy.
  function meleeComboHP(melee){
    const M = Math.max(0, Math.min(500, melee));
    let dmg;  // raw HP

    if (M <= 50){
      // 0â€“50
      dmg = 17 + 0.12 * M;
    } else if (M <= 150){
      // 50â€“150
      dmg = 21.6 + 0.099 * M;
    } else if (M <= 300){
      // 150â€“300
      dmg = 14.3 + 0.158 * M;
    } else {
      // 300â€“500
      dmg = 49.8 + 0.040 * M;
    }

    return dmg;
  }

  // =================== KI MODEL (still %-based, converted to HP) ===================
  function kiComboHP(level, ki){
    const comboPct = SCALE * (
      K_BASE +
      K_COEF * Math.pow(Math.max(0, ki), K_EXP) +
      K_LVL * Math.max(0, level)
    );
    return pctToHP(comboPct);  // % of 100 HP â†’ HP
  }

  // =================== RESIST CURVES (0 Res = full damage) ===================
	// Melee resistance multipliers based on CrYm0's dataset
const MELEE_RES_POINTS = [
  1,    2,       3,       4,       5,
  7,    8,       9,       10,      11,
  12,   13,      58,      88,      128
];

const MELEE_RES_MULT = [
  1.0,
  0.948152,
  0.938052,
  0.927952,
  0.917793,
  0.886020,
  0.875820,
  0.865620,
  0.859613,
  0.849303,
  0.839053,
  0.828803,
  0.594166,
  0.490736,
  0.398502
];

function multMelee(R){
  const RES  = MELEE_RES_POINTS;
  const MULT = MELEE_RES_MULT;

  // sanitize input
  let r = Number(R) || 0;
  if (r <= RES[0]) return MULT[0];
  if (r >= RES[RES.length - 1]) return MULT[RES.length - 1];

  // linear interpolation between nearest known Res points
  for (let i = 0; i < RES.length - 1; i++){
    const r0 = RES[i],   r1 = RES[i+1];
    const m0 = MULT[i],  m1 = MULT[i+1];
    if (r >= r0 && r <= r1){
      const t = (r - r0) / (r1 - r0);
      return m0 + t * (m1 - m0);
    }
  }

  // fallback (should never hit)
  return MULT[MULT.length - 1];
}

  function multKi(R){
    const x = Math.max(0, R);
    return 1 / (1 + 0.0008*x + 0.00004*x*x);
  }

  const maxHP = H => 100 + 0.5*Math.max(0, H);

  const fmt    = x => Number.isFinite(x) ? (Math.round(x*100)/100).toFixed(2) : 'â€“';
  const fmtPct = x => Number.isFinite(x) ? (Math.round(x*100)/100).toFixed(2)+'%' : 'â€“';
  function fmtHPpct(dmgHP, hpMax){
    if (!Number.isFinite(dmgHP) || !Number.isFinite(hpMax) || hpMax <= 0) return 'â€“';
    const hp  = (Math.round(dmgHP*100)/100).toFixed(2);
    const pct = (Math.round((dmgHP/hpMax*100)*100)/100).toFixed(2);
    return `${hp} (${pct}%)`;
  }

  // =================== MELEE CALCULATOR ===================
  function calcMelee(){
    const melee = +document.getElementById('melee').value || 0;

    const baseCombo = meleeComboHP(melee);
    const combo10   = meleeComboHP(melee + 10);
    const combo50   = meleeComboHP(melee + 50);
    const combo100  = meleeComboHP(melee + 100);

    document.getElementById('m_total').textContent   = fmt(baseCombo);
    document.getElementById('m_plus10').textContent  = fmt(combo10);
    document.getElementById('m_plus50').textContent  = fmt(combo50);
    document.getElementById('m_plus100').textContent = fmt(combo100);
  }

  // =================== KI CALCULATOR ===================
  function calcKi(){
    const ki    = +document.getElementById('ki').value || 0;
    const level = +document.getElementById('levelK').value || 0;

    const comboHP = kiComboHP(level, ki);
    const perHit  = comboHP / 4;
    const fromLevel = pctToHP(SCALE * (K_LVL*Math.max(0,level)));
    const fromKi    = pctToHP(SCALE * (K_COEF*Math.pow(Math.max(0,ki), K_EXP)));

    document.getElementById('k_total').textContent = fmt(comboHP);
    document.getElementById('k_hit').textContent   = fmt(perHit);
    document.getElementById('k_lvl').textContent   = fmt(fromLevel);
    document.getElementById('k_ki').textContent    = fmt(fromKi);
  }

  document.getElementById('calcMelee').addEventListener('click', calcMelee);
  document.getElementById('calcKi').addEventListener('click', calcKi);

  // =================== MELEE RESISTANCE TAB ===================
  function calcRes(){
    const attMelee = +document.getElementById('r_attMelee').value || 0;
    const baseRes  = +document.getElementById('r_res').value || 0;
    const hpStat   = +document.getElementById('r_hp').value || 0;

    const hpMax = maxHP(hpStat);
    const baseCombo = meleeComboHP(attMelee);  // raw HP vs 100 HP dummy

    const dNow   = baseCombo * multMelee(baseRes);
    const d10    = baseCombo * multMelee(baseRes + 10);
    const d50    = baseCombo * multMelee(baseRes + 50);
    const d100   = baseCombo * multMelee(baseRes + 100);

    document.getElementById('r_now').textContent  = fmtHPpct(dNow, hpMax);
    document.getElementById('r_10').textContent   = fmtHPpct(d10, hpMax);
    document.getElementById('r_50').textContent   = fmtHPpct(d50, hpMax);
    document.getElementById('r_100').textContent  = fmtHPpct(d100, hpMax);
  }
  document.getElementById('calcRes').addEventListener('click', calcRes);

  // =================== BATTLE SIMULATOR ===================
  function predictMelee(att, def){
    const comboHP = meleeComboHP(att.melee);      // raw HP damage from attacker
    const mult    = multMelee(def.resM);
    const dmgHP   = comboHP * mult;
    return 100 * dmgHP / maxHP(def.hp);           // % of defender's real HP
  }

  function predictKi(att, def){
    const effLvl = att.lvl * CAL.KI_LEVEL_FACTOR;
    const comboHP = kiComboHP(effLvl, att.ki);
    const mult    = multKi(def.resK);
    const dmgHP   = comboHP * mult;
    const pct     = 100 * dmgHP / maxHP(def.hp);
    return pct * CAL.KI_PCT_SCALE;
  }

  function readChar(prefix){
    return {
      lvl:  +document.getElementById(prefix+'_lvl').value || 0,
      hp:   +document.getElementById(prefix+'_hp').value || 0,
      melee:+document.getElementById(prefix+'_melee').value || 0,
      ki:   +document.getElementById(prefix+'_ki').value || 0,
      resM: +document.getElementById(prefix+'_resM').value || 0,
      resK: +document.getElementById(prefix+'_resK').value || 0,
    };
  }

  function runSim(){
    const A = readChar('A');
    const B = readChar('B');

    const ABm = predictMelee(A,B);
    const ABk = predictKi(A,B);
    const BAm = predictMelee(B,A);
    const BAk = predictKi(B,A);

    document.getElementById('AB_melee').textContent = fmtPct(ABm);
    document.getElementById('AB_ki').textContent    = fmtPct(ABk);
    document.getElementById('BA_melee').textContent = fmtPct(BAm);
    document.getElementById('BA_ki').textContent    = fmtPct(BAk);
  }
  document.getElementById('simRun').addEventListener('click', runSim);

  // =================== INIT ===================
  calcMelee();
  calcKi();
  calcRes();
  runSim();
</script>
</body>
</html>
